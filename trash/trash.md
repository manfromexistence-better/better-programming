All the codes that don't require in main are gathered here.